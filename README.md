# Расчёт высоконагруженного сервиса  


### 1 Тема  
VPN provider.  

### 2 Определение возможного диапазона нагрузок подобного проекта.
### 3 Выбор планируемой нагрузки как 30% рынка в России.
<a href="https://www.gfk.com/ru/insaity/press-release/issledovanie-gfk-proniknovenie-interneta-v-rossii-1/">количество пользователей интернета в России</a> = 90000000  
<a href="https://www.vpnmentor.com/blog/vpn-use-data-privacy-stats/">количество пользователей VPN в России</a> = 24%  
<a href="https://vc.ru/flood/44138-pochemu-rossiyskie-operatory-vozvrashchayut-bezlimitnyy-internet">средний трафик на мобильное устройство в месяц</a> = 8 Gb  
<a href="https://park.mail.ru/blog/topic/view/13345/">моделируемая для рынка в России</a> = 30%  
Получаем нагрузку в 20 Gb/s  

### 4 Логическая схема базы данных (без выбора СУБД)  
Особенности хорошего VPN провайдера:  
- Не хранит данные пользователей, не логгирует конечные адреса.  
- Предоставляет безлимитный доступ, только ограничивает максимальную скорость в зависимости от тарифа. По мнению МТС: "<a href="https://vc.ru/flood/44138-pochemu-rossiyskie-operatory-vozvrashchayut-bezlimitnyy-internet">Наши клиенты живут в цифровой среде и не хотят думать о лимитах на интернет, они воспринимают их как искусственные ограничения.</a>"  
  
Поэтому в базе хранится только чувствительная и важная информация: Логин, пароль пользователя, его текущий тариф в Kb/s.  

### 5 Физическая системы хранения (конкретные СУБД, шардинг, расчет нагрузки, обоснование реализуемости на основе результатов нагрузочного тестирования)

Расчёт нагрузки на базу данных:
VPN сервера делают 1 select в момент подключения клиента, Billing cистема делает update раз в месяц.  
<a href="https://pikabu.ru/story/kak_izmenilsya_pikabu_za_2018_god_6393562">среднее время посещения pikabu.ru</a> = 9 мин.  
Рассматрим этот развлекательный сайт как типичный случай использования. Пользователь будет переподключаться к VPN, генерируя 1 запрос в базу, раз в 9 минут.  
Получается, что наши потенциальные 6480000 пользователей, используя сервис единовременно, будут генерировать нагрузку 12000 rps select по индексу для проверки авторизации.

### 6 Выбор прочих технологий: языки программирования, фреймфорки, протоколы взаимодействия, веб-сервера и т.д. (с обоcнованием выбора)  
### 7 Расчет нагрузки и потребного оборудования  
Расчёт нагрузки на VPN (TODO)  
### 8 Выбор хостинга / облачного провайдера и расположения серверов  
### 9 Схема балансировки нагрузки (входящего трафика и внутрипроектного, терминация SSL)  
### 10 Обеспечение отказоустойчивости  
